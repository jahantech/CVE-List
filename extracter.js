var https = require('https')
var AdmZip = require('adm-zip')
var fs = require('fs')

var objectsToDownload = [ "CVE-List", "https://nvd.nist.gov/feeds/xml/cve/nvdcve-2.0-Modified.xml.zip"]

var download = function(filename, url, cb) {
	var tmpFilePath = filename + ".zip"
	https.get(url, function(response) {
		response.on('data', function (data) {
		 	fs.appendFileSync(tmpFilePath, data)
		});
		 		
		response.on('end', function() {
		 	var zip = new AdmZip(tmpFilePath)
		 	zip.extractAllTo(filename)
		 		fs.unlink(tmpFilePath)
			 })
		 });
}


function loadXMLDoc(filePath) {
        var fs = require('fs');
        var xml2js = require('xml2js');
        var json;
        try {
            var fileData = fs.readFileSync(filePath, 'ascii');

            var parser = new xml2js.Parser();

            parser.parseString(fileData.substring(0, fileData.length), function (err, result) {
            	json = JSON.stringify(result);
            	
 			});
            var i; 
            json = JSON.parse(json);
         
            for(i=0 ; i < (json.nvd.entry).length;i++){
            
            	console.log(json.nvd.entry[i].$.id+" "
            		+json.nvd.entry[i]["vuln:cvss"][0]['cvss:base_metrics'][0]["cvss:score"][0])
            	
            }
            
        }
        catch (ex) {
        	console.log(ex)
        }
}

			download(objectsToDownload[0], objectsToDownload[1]); 
			loadXMLDoc(objectsToDownload[0]+"/"+"nvdcve-2.0-Modified.xml");
	